version: 2.1

jobs:
  code_Formatting:
    docker:
      - image: reactnativecommunity/react-native-android:latest
    steps:
      - checkout  # Check out your source code
      
      - run:
          name: Install dependencies
          command: |
            npm install
          
      - run:
          name: Run ESLint
          command: |
            npx eslint . --max-warnings=0  # Lint all files and fail the build if there are warnings

      - run:
          name: Run ESLint --fix
          command: |
            npx eslint . --fix  # Automatically fix fixable ESLint issues
      
      - run:
          name: Run Prettier
          command: |
            npx prettier --write .  # Format all files with Prettier

  build_android:
    docker:
      - image: reactnativecommunity/react-native-android:latest
    steps:
      - checkout  # Check out your source code
      
      - run:
          name: Install dependencies
          command: |
            npm install

      - restore_cache:
          keys:
            - gradle-cache-{{ .Branch }}-{{ checksum "android/build.gradle" }}
            - gradle-cache-{{ .Branch }}
            - gradle-cache

      - run:
          name: Make Gradle wrapper executable
          command: |
            chmod +x ./android/gradlew
          
      - run:
          name: Build APK
          command: |
            cd android
            ./gradlew assembleRelease

      - save_cache:
          paths:
            - ~/.gradle/caches
            - ~/.gradle/wrapper
          key: gradle-cache-{{ .Branch }}-{{ checksum "android/build.gradle" }}

  build_ios:
    macos:
      xcode: "14.0.0"  # Specify your Xcode version
    steps:
      - checkout  # Check out your source code
      
      - run:
          name: Install dependencies
          command: |
            npm install
          
      - run:
          name: Build iOS
          command: |
            cd ios
            xcodebuild -workspace YourApp.xcworkspace -scheme YourApp -sdk iphoneos -configuration AppStoreDistribution archive -archivePath $HOME/YourApp.xcarchive

workflows:
  version: 2
  linting_and_building:
    jobs:
      - code_Formatting
      - build_android:
          requires:
            - code_Formatting
      - build_ios:
          requires:
            - code_Formatting
